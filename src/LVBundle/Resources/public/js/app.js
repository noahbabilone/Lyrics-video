var player, time_update_interval = 0;var PLAY = 0, INDEX = 0, START, END;var query = document.querySelector.bind(document);var data = $("#data-video").attr("data-video");var idVideo = $("#data-video").attr("data-id-video");//obj = JSON.parse('{"data":'+data+'}');var DataVideo = $.parseJSON(data);// console.log(DataVideo);function onYouTubeIframeAPIReady() {    if (idVideo) {        player = new YT.Player('youtube-video', {            width: 879,            height: 572,            videoId: idVideo,            playerVars: {                'autoplay': 0, 'controls': 1, 'autohide': 0, 'wmode': 'opaque',                'fs': 0                // playlist: 'u1gpkOSYntY,L56Q6ZdpZzc',            },            events: {                onReady: onPlayerReady,                onStateChange: onPlayerStateChange            }        });    }}var ready = false;function onPlayerReady() {    START = formatTimeVideo(DataVideo[0].start);    END = formatTimeVideo(DataVideo[0].end);    $('.sous-titre').removeClass("hide");    $("#signal-icon").addClass("fa-play");    updateTimerDisplay();}function onPlayerStateChange(event) {    if (event.data == YT.PlayerState.PLAYING) {        $('.sous-titre').html(DataVideo[INDEX].text);        ready = true;        time_update_interval = setInterval(function () {            updateTimerDisplay();            updateLyricsDisplay();        }, 100)        $("#signal-icon").addClass("fa-play").removeClass("fa-pause");    } else {        //Video has paused and clear any old interval.        clearInterval(time_update_interval);        updateLyricsDisplay();        $("#signal-icon").addClass("fa-pause").removeClass("fa-play");    }}function formatTimeVideo(chaine) {    var time = chaine.split(":");    return (time.length >= 3) ?    parseInt(time[0] * 3600) + parseInt(time[1] * 60) + parseInt(time[2]) : null;}function updateLyricsDisplay() {    var time = Math.round(player.getCurrentTime());    //console.log("UpdatLD ==> START :" + DataVideo[INDEX].start + "  End :" + DataVideo[INDEX].end + '  INDEX: ' + INDEX);    console.log("time_update_interval :" + time_update_interval);    if (time < START) {        seekLyrics(time, 0, INDEX);        // console.log("INFERIEUR");    } else if (time >= END && INDEX < DataVideo.length) {        seekLyrics(time, INDEX, DataVideo.length);        //console.log("DEPASSER");    }}function seekLyrics(time, debut, fin) {    var j = debut;    //console.log("Debut :" + debut + " Fin: " + fin);    while (j < fin && j < DataVideo.length) {        if (time >= formatTimeVideo(DataVideo[j].start) && time < formatTimeVideo(DataVideo[j].end)) {            INDEX = j;            START = formatTimeVideo(DataVideo[INDEX].start);            END = formatTimeVideo(DataVideo[INDEX].end);            $('.sous-titre').html(DataVideo[INDEX].text);            // console.log(" TrouvÃ©: j :" + j + " start " + DataVideo[j].start + " End " + DataVideo[j].end);            return true;        }        j++    }    return false;}function updateTimerDisplay() {    $('#current').text(formatTime(player.getCurrentTime()));    $('#duration').text(formatTime(player.getDuration()));}function formatTime(time) {    time = Math.round(time);    var minutes = Math.floor(time / 60),        seconds = time - minutes * 60;    seconds = seconds < 10 ? '0' + seconds : seconds;    return minutes + ":" + seconds;}$("#Signaler").click(function (e) {    var pst = player.getPlayerState();    if (pst == 0 || pst == 2 || pst == 5) {        player.playVideo();        $("#modal-signal").modal('hide')    } else if (pst == 1) {        $("#modal-signal").modal('show');        $(".time-signal").html(formatTime(player.getCurrentTime()));        player.pauseVideo();        $(".ok-report").attr("data-user", $.trim($(this).attr("data-user").replace('user_', '')));        $(".ok-report").attr("data-video", $.trim($(this).attr("data-video").replace('video_', '')));        $(".ok-report").attr("data-time-report", formatTime(player.getCurrentTime()));    }    e.preventDefault();});$(".ok-report").click(function (e) {    $("#modal-signal").modal('hide')    var idVideo = $(this).attr("data-video");    var time = $(this).attr("data-time-report");    var user = $(this).attr('data-user');    var data = {        user: user,        video: idVideo,        time: time,    };    var href = Routing.generate('add_report_ajax');    console.log(data);    if (idVideo && href) {        console.log("signaler");        $.ajax({            url: href,            dataType: "json",            data: data,            type: 'GET',        }).done(function (data) {            console.log(data);        });    } else {        console.log("Test");    }    player.playVideo();    e.preventDefault();});$(".btn_add_comment").click(function (e) {    var message = $.trim($('#textarea-comment').val());    var user = $(this).attr('data-user').replace('user_', '');    var video = $(this).attr('data-video').replace('video_', '');    var href = Routing.generate('add_comment_ajax');    console.log(message + ' ' + user + ' href' + href);    if (message && user) {        var data = {            'user': user,            'video': video,            'message': message,        }        $.ajax({            url: href,            dataType: "json",            data: data,            type: 'GET',        }).done(function (data) {            console.log(data);            if (data.response) {                var $comment = $('<div class="media"></div>');                var $header = '<div class="media-left media-middle"><a href="#"><img class="media-object" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9InllcyI/PjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+PCEtLQpTb3VyY2UgVVJMOiBob2xkZXIuanMvNjR4NjQKQ3JlYXRlZCB3aXRoIEhvbGRlci5qcyAyLjYuMC4KTGVhcm4gbW9yZSBhdCBodHRwOi8vaG9sZGVyanMuY29tCihjKSAyMDEyLTIwMTUgSXZhbiBNYWxvcGluc2t5IC0gaHR0cDovL2ltc2t5LmNvCi0tPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PCFbQ0RBVEFbI2hvbGRlcl8xNTU2YTRkYWJlMyB0ZXh0IHsgZmlsbDojQUFBQUFBO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1mYW1pbHk6QXJpYWwsIEhlbHZldGljYSwgT3BlbiBTYW5zLCBzYW5zLXNlcmlmLCBtb25vc3BhY2U7Zm9udC1zaXplOjEwcHQgfSBdXT48L3N0eWxlPjwvZGVmcz48ZyBpZD0iaG9sZGVyXzE1NTZhNGRhYmUzIj48cmVjdCB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIGZpbGw9IiNFRUVFRUUiLz48Zz48dGV4dCB4PSIxMi40NTgzMzM5NjkxMTYyMTEiIHk9IjM2LjgiPjY0eDY0PC90ZXh0PjwvZz48L2c+PC9zdmc+"'                    + ' alt = "..." >' + '</a></div >';                var $body = $(' <div class="media-body"></div>');                $body.append('<h4 class="media-heading"><span class="text-capitalize">' + data.user + '</span> ' +                    '<small>' + data.date + '</small></h4>')                $body.append('<p>' + message + '</p>')                $comment.append($header);                $comment.append($body);                $("#block_comment").prepend($('<div class="col-sm-10"></div>').html($comment).fadeIn("slow"));            } else {                $('#error-message').html("Error function ajax");                $('#bloc-error').removeClass().fadeIn("slow")                    .delay(7000).fadeOut(400, function () {                    $(this).remove();                });            }        });    } else {        $('#error-message').html("Vous n'avez rien saisi dans le champs Message.");        $('#bloc-error')            .removeClass().fadeIn("slow")            .delay(7000).fadeOut(400, function () {            $(this).remove();        });        console.log("Vous n\'a rien saisi");    }    console.log("add-comment");    e.preventDefault();});