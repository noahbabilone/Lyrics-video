var player, time_update_interval = 0;var PLAY = 0, INDEX = 0, START, END;var query = document.querySelector.bind(document);var data = $("#data-video").attr("data-video");var idVideo = $("#data-video").attr("data-id-video");//obj = JSON.parse('{"data":'+data+'}');var DataVideo = $.parseJSON(data);// console.log(DataVideo);function onYouTubeIframeAPIReady() {    if (idVideo) {        player = new YT.Player('youtube-video', {            width: 879,            height: 572,            videoId: idVideo,            playerVars: {                'autoplay': 0, 'controls': 1, 'autohide': 0, 'wmode': 'opaque',                'fs': 0                // playlist: 'u1gpkOSYntY,L56Q6ZdpZzc',            },            events: {                onReady: onPlayerReady,                onStateChange: onPlayerStateChange            }        });    }}var ready = false;function onPlayerReady() {    START = formatTimeVideo(DataVideo[0].start);    END = formatTimeVideo(DataVideo[0].end);    $('.sous-titre').removeClass("hide");    $("#signal-icon").addClass("fa-play");    updateTimerDisplay();}function onPlayerStateChange(event) {    if (event.data == YT.PlayerState.PLAYING) {        $('.sous-titre').html(DataVideo[INDEX].text);        ready = true;        time_update_interval = setInterval(function () {            updateTimerDisplay();            updateLyricsDisplay();        }, 100)        $("#signal-icon").addClass("fa-play").removeClass("fa-pause");    } else {        //Video has paused and clear any old interval.        clearInterval(time_update_interval);        updateLyricsDisplay();        $("#signal-icon").addClass("fa-pause").removeClass("fa-play");    }}function formatTimeVideo(chaine) {    var time = chaine.split(":");    return (time.length >= 3) ?    parseInt(time[0] * 3600) + parseInt(time[1] * 60) + parseInt(time[2]) : null;}function updateLyricsDisplay() {    var time = Math.round(player.getCurrentTime());    //console.log("UpdatLD ==> START :" + DataVideo[INDEX].start + "  End :" + DataVideo[INDEX].end + '  INDEX: ' + INDEX);    console.log("time_update_interval :" + time_update_interval);    if (time < START) {        seekLyrics(time, 0, INDEX);        // console.log("INFERIEUR");    } else if (time >= END && INDEX < DataVideo.length) {        seekLyrics(time, INDEX, DataVideo.length);        //console.log("DEPASSER");    }}function seekLyrics(time, debut, fin) {    var j = debut;    //console.log("Debut :" + debut + " Fin: " + fin);    while (j < fin && j < DataVideo.length) {        if (time >= formatTimeVideo(DataVideo[j].start) && time < formatTimeVideo(DataVideo[j].end)) {            INDEX = j;            START = formatTimeVideo(DataVideo[INDEX].start);            END = formatTimeVideo(DataVideo[INDEX].end);            $('.sous-titre').html(DataVideo[INDEX].text);            // console.log(" TrouvÃ©: j :" + j + " start " + DataVideo[j].start + " End " + DataVideo[j].end);            return true;        }        j++    }    return false;}function updateTimerDisplay() {    $('#current').text(formatTime(player.getCurrentTime()));    $('#duration').text(formatTime(player.getDuration()));}function formatTime(time) {    time = Math.round(time);    var minutes = Math.floor(time / 60),        seconds = time - minutes * 60;    seconds = seconds < 10 ? '0' + seconds : seconds;    return minutes + ":" + seconds;}$("#Signaler").click(function (e) {    var pst = player.getPlayerState();    if (pst == 0 || pst == 2 || pst == 5) {        player.playVideo();        $("#modal-signal").modal('hide')    } else if (pst == 1) {        $("#modal-signal").modal('show');        $(".time-signal").html(formatTime(player.getDuration()));        player.pauseVideo();    }    e.preventDefault();});